# .htaccess — raiz do Servite

# Evitar listagem de diretório
Options -Indexes

# Prioridade de arquivos
DirectoryIndex index.html index.php

# Cabeçalhos mínimos de segurança
<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "no-referrer-when-downgrade"
  # CSP: ajustar em produção (remover unsafe-* se possível)
  Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
  # HSTS (descomente apenas se seu site estiver em HTTPS)
  # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# Negar acesso por nome a arquivos sensíveis
<FilesMatch "^(?:\.env|composer\.json|composer\.lock|config\.php|README\.md|.*\.sql|.*\.log|.*\.ini)$">
  Require all denied
</FilesMatch>

# Impedir acesso ao diretório .git
RewriteEngine On
RewriteRule (^|/)\.git - [F,L]

# Evitar execução de scripts dentro de /uploads, mas permitir imagens e arquivos estáticos
# (bloqueia apenas extensões executáveis)
RewriteRule ^uploads/.*\.(php|phtml|phar|pl|py|sh)$ - [F,L]

# Front controller — encaminha para index.php apenas quando não existir arquivo/diretório físico
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [QSA,L]

# Proteger o próprio .htaccess
<Files ".htaccess">
  Require all denied
</Files>
